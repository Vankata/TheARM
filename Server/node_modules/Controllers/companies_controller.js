var dataContext = require('../../models/server-context.js');
var Q = require("Q");

module.exports = {
    getAll: function () {
        var deferred = Q.defer();
        
        dataContext().then(function (models) {
            models.company.find({}, function (error, results) {
                if (error) {
                    deferred.reject(error);
                }

                if (results && results.length > 0) {
                    deferred.resolve(results);
                }
            });
        }, function (error) {
            deferred.reject(error);
        });

        return deferred.promise;
    },
    getResourcesByCompany: function (companyId) {
        var deferred = Q.defer();

        dataContext().then(function (models) {
            models.resource
                .findByCompany({ companyId: companyId }, function (error, results) {
                    if (error) {
                        deferred.reject(error);
                    }

                    deferred.resolve(results);
            });
        }, function (error) {
            deferred.reject(error);
        });

        return deferred.promise;
    },
    getResourceDataByCompany: function (companyId, resourceId) {
        var deferred = Q.defer();

        dataContext().then(function (models) {
            models.resource
                .findByCompany({ companyId: companyId }, function (error, results) {
                    if (error) {
                        deferred.reject(error);
                    }

                    deferred.resolve(results.find(function (res) {
                        return res.resourceId == resourceId
                    }));
                });
        }, function (error) {
            deferred.reject(error);
        });

        return deferred.promise;
    }
};