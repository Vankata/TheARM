var datacontext = require('../../models/server-context.js');
var hasher = require('password-hash');

module.exports =
{
    loginUser: function (username, password, token, callback) {
        var context = datacontext();
        context.then(function (models)
        {
            models.user.find({ displayName : username }, function (error, results)
            {
                if (error)
                {
                    callback("no");
                }

                if (results.length > 0)
                {
                    if (hasher.verify(password, results[0].password))
                    {
                        console.log("Login successful");
                        results[0].token = token;
                        results[0].save(function (error)
                        {
                            if (error)
                            {
                                callback("no");
                            }
                        });
                        callback("ok");
                    }
                }                

                callback("no");
            });
        }, function (eror)
        {
            callback("Server error");
        });
    },

    registerUser: function (username, password, token, displayName) {
    }
};